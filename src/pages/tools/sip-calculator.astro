---
import Layout from '@layouts/Layout.astro';
---

<Layout
  title="Tính SIP"
  description="Công cụ ước tính giá trị đầu tư định kỳ hàng tháng (Systematic Investment Plan)"
>
  <div class="container mx-auto px-4 py-12 sm:px-6 lg:px-8">
    <div class="mx-auto max-w-4xl">
      <a
        href={`${import.meta.env.BASE_URL}tools`}
        class="inline-flex items-center text-sm text-primary-600 hover:text-primary-700 dark:text-primary-400"
      >
        <svg
          class="mr-1 h-4 w-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
        Quay lại công cụ
      </a>

      <h1 class="mt-4 text-4xl font-bold text-gray-900 dark:text-white">
        Tính SIP (Đầu tư định kỳ)
      </h1>
      <p class="mt-2 text-gray-600 dark:text-gray-300">
        Ước tính giá trị đầu tư định kỳ hàng tháng vào quỹ mở
      </p>

      <div class="mt-8 grid gap-8 lg:grid-cols-2">
        <!-- Input Form -->
        <div class="card">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
            Thông tin đầu vào
          </h2>
          <form id="sip-form" class="mt-6 space-y-6">
            <div>
              <label
                for="monthly-investment"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >
                Số tiền đầu tư hàng tháng (VNĐ)
              </label>
              <input
                type="number"
                id="monthly-investment"
                name="monthly-investment"
                value="1000000"
                min="100000"
                step="100000"
                required
                class="mt-1 block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white"
              />
            </div>

            <div>
              <label
                for="return-rate"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >
                Lợi nhuận kỳ vọng hàng năm (%)
              </label>
              <input
                type="number"
                id="return-rate"
                name="return-rate"
                value="12"
                min="0"
                max="100"
                step="0.1"
                required
                class="mt-1 block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white"
              />
            </div>

            <div>
              <label
                for="sip-years"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300"
              >
                Thời gian đầu tư (năm)
              </label>
              <input
                type="number"
                id="sip-years"
                name="sip-years"
                value="10"
                min="1"
                max="50"
                required
                class="mt-1 block w-full rounded-lg border border-gray-300 bg-white px-4 py-2 text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-800 dark:text-white"
              />
            </div>

            <button type="submit" class="btn-primary w-full">
              Tính toán
            </button>
          </form>
        </div>

        <!-- Results -->
        <div class="card">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
            Kết quả
          </h2>
          <div id="sip-results" class="mt-6 space-y-4">
            <div class="rounded-lg bg-primary-50 p-4 dark:bg-primary-900/20">
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Tổng giá trị cuối kỳ
              </p>
              <p
                id="sip-final-amount"
                class="mt-1 text-3xl font-bold text-primary-600 dark:text-primary-400"
              >
                0 ₫
              </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div class="rounded-lg bg-gray-50 p-4 dark:bg-gray-800">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Tổng đầu tư
                </p>
                <p
                  id="sip-total-invested"
                  class="mt-1 text-xl font-semibold text-gray-900 dark:text-white"
                >
                  0 ₫
                </p>
              </div>

              <div class="rounded-lg bg-gray-50 p-4 dark:bg-gray-800">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                  Lợi nhuận
                </p>
                <p
                  id="sip-total-returns"
                  class="mt-1 text-xl font-semibold text-secondary-600 dark:text-secondary-400"
                >
                  0 ₫
                </p>
              </div>
            </div>

            <div
              class="rounded-lg border border-gray-200 p-4 dark:border-gray-700"
            >
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Tỷ lệ lợi nhuận / vốn
              </p>
              <div class="mt-2 flex items-center space-x-2">
                <div
                  class="h-4 flex-1 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700"
                >
                  <div
                    id="sip-ratio-bar"
                    class="h-full bg-secondary-500 transition-all duration-500"
                    style="width: 0%"
                  >
                  </div>
                </div>
                <span
                  id="sip-ratio-text"
                  class="text-sm font-medium text-gray-900 dark:text-white"
                  >0%</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Info Section -->
      <div class="card mt-12">
        <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">
          SIP là gì?
        </h2>
        <p class="mt-4 text-gray-600 dark:text-gray-300">
          <strong>SIP (Systematic Investment Plan)</strong> là phương pháp đầu tư
          định kỳ một khoản tiền cố định vào quỹ đầu tư. Thay vì bỏ ra một khoản
          lớn một lần, bạn đầu tư đều đặn hàng tháng.
        </p>
        <h3 class="mt-4 font-semibold text-gray-900 dark:text-white">
          Lợi ích của SIP:
        </h3>
        <ul
          class="mt-2 list-inside list-disc space-y-2 text-gray-600 dark:text-gray-300"
        >
          <li>
            <strong>Kỷ luật đầu tư:</strong> Tự động đầu tư định kỳ giúp bạn xây
            dựng thói quen tốt
          </li>
          <li>
            <strong>Giảm rủi ro thời điểm:</strong> Không cần lo lắng thời điểm thị
            trường tốt hay xấu
          </li>
          <li>
            <strong>Vốn nhỏ:</strong> Bắt đầu với số tiền nhỏ, phù hợp với người
            mới
          </li>
          <li>
            <strong>Hiệu ứng lãi kép:</strong> Lợi nhuận được tái đầu tư, tăng trưởng
            theo cấp số nhân
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    import { calculateSIP, formatCurrency } from '@/utils/calculators';

    const form = document.getElementById('sip-form') as HTMLFormElement;

    form?.addEventListener('submit', (e) => {
      e.preventDefault();

      const monthlyInvestment = parseFloat(
        (document.getElementById('monthly-investment') as HTMLInputElement)
          .value
      );
      const returnRate = parseFloat(
        (document.getElementById('return-rate') as HTMLInputElement).value
      );
      const years = parseInt(
        (document.getElementById('sip-years') as HTMLInputElement).value
      );

      try {
        const result = calculateSIP(monthlyInvestment, returnRate, years);

        // Update results
        document.getElementById('sip-final-amount')!.textContent =
          formatCurrency(result.finalAmount);
        document.getElementById('sip-total-invested')!.textContent =
          formatCurrency(result.totalInvested);
        document.getElementById('sip-total-returns')!.textContent =
          formatCurrency(result.totalReturns);

        // Update ratio
        const ratio = (result.totalReturns / result.totalInvested) * 100;
        document.getElementById('sip-ratio-bar')!.style.width =
          `${Math.min(ratio, 100)}%`;
        document.getElementById('sip-ratio-text')!.textContent =
          `${ratio.toFixed(1)}%`;
      } catch {
        alert('Vui lòng kiểm tra lại các giá trị nhập vào');
      }
    });

    // Initial calculation
    form?.dispatchEvent(new Event('submit'));
  </script>
</Layout>
